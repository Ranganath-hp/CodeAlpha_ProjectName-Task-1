from scapy.all import sniff, IP, TCP, UDP

# Function to process each captured packet
def analyze_packet(packet):
    if IP in packet:
        ip_layer = packet[IP]
        src_ip = ip_layer.src
        dst_ip = ip_layer.dst
        protocol = ip_layer.proto

        print(f"\n[+] Packet captured:")
        print(f"    Source IP      : {src_ip}")
        print(f"    Destination IP : {dst_ip}")
        
        if packet.haslayer(TCP):
            print("    Protocol       : TCP")
            print(f"    Source Port    : {packet[TCP].sport}")
            print(f"    Destination Port: {packet[TCP].dport}")
        
        elif packet.haslayer(UDP):
            print("    Protocol       : UDP")
            print(f"    Source Port    : {packet[UDP].sport}")
            print(f"    Destination Port: {packet[UDP].dport}")
        
        else:
            print("    Protocol       : Other")

# Start packet sniffing (you may need admin rights)
print("[*] Starting packet capture... Press Ctrl+C to stop.")
sniff(prn=analyze_packet, store=False)
